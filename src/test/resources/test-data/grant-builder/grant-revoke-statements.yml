# Grant/Revoke Statement Tests
# Organized by object type to match Snowflake documentation structure
# Reference: https://docs.snowflake.com/en/sql-reference/sql/grant-privilege
#
# Each test case defines:
#   - grant: The grant model parameters
#   - expectedGrantStatement: The expected SQL GRANT statement
#   - expectedRevokeStatement: The expected SQL REVOKE statement

tests:
  # Schema Objects - Tables
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#schema-object-privileges
  - name: "SELECT on TABLE"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_TABLE_1
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" FROM ROLE MOCK_ROLE_1;"

  - name: "SELECT on TABLE with quoted name"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA."mock_table_1"
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"mock_table_1\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"mock_table_1\" FROM ROLE MOCK_ROLE_1;"

  - name: "SELECT on TABLE with special characters"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA."MOCK_table_1?"
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_table_1?\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_table_1?\" FROM ROLE MOCK_ROLE_1;"

  - name: "SELECT on TABLE with GRANT OPTION"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_TABLE_1
      role: MOCK_ROLE_1
      grantOption: true
    expectedGrantStatement: "GRANT SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE MOCK_ROLE_1 WITH GRANT OPTION;"
    expectedRevokeStatement: "REVOKE SELECT ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" FROM ROLE MOCK_ROLE_1;"

  - name: "OWNERSHIP on TABLE"
    grant:
      privilege: OWNERSHIP
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_TABLE_1
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT OWNERSHIP ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "GRANT OWNERSHIP ON TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE SECURITYADMIN COPY CURRENT GRANTS;"

  # Schema Objects - External Tables
  - name: "SELECT on EXTERNAL_TABLE"
    grant:
      privilege: SELECT
      objectType: EXTERNAL_TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_TABLE_1
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT SELECT ON EXTERNAL TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON EXTERNAL TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" FROM ROLE MOCK_ROLE_1;"

  - name: "OWNERSHIP on EXTERNAL_TABLE"
    grant:
      privilege: OWNERSHIP
      objectType: EXTERNAL_TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_TABLE_1
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT OWNERSHIP ON EXTERNAL TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "GRANT OWNERSHIP ON EXTERNAL TABLE \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_TABLE_1\" TO ROLE SECURITYADMIN COPY CURRENT GRANTS;"

  # Future Grants
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#future-grants-on-database-or-schema-objects
  - name: "SELECT on FUTURE TABLES"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.<TABLE>
      role: MOCK_ROLE_1
      future: true
    expectedGrantStatement: "GRANT SELECT ON FUTURE TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON FUTURE TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  - name: "SELECT on FUTURE TABLES with quoted database"
    grant:
      privilege: SELECT
      objectType: TABLE
      objectName: "\"Mock_db_1?.123\".MOCK_SCHEMA.<TABLE>"
      role: MOCK_ROLE_1
      future: true
    expectedGrantStatement: "GRANT SELECT ON FUTURE TABLES IN SCHEMA \"Mock_db_1?.123\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON FUTURE TABLES IN SCHEMA \"Mock_db_1?.123\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  - name: "SELECT on FUTURE EXTERNAL_TABLES"
    grant:
      privilege: SELECT
      objectType: EXTERNAL_TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.<EXTERNAL_TABLE>
      role: MOCK_ROLE_1
      future: true
    expectedGrantStatement: "GRANT SELECT ON FUTURE EXTERNAL TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON FUTURE EXTERNAL TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  - name: "OWNERSHIP on FUTURE TABLES"
    grant:
      privilege: OWNERSHIP
      objectType: TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.<TABLE>
      role: MOCK_ROLE_1
      future: true
    expectedGrantStatement: "GRANT OWNERSHIP ON FUTURE TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "REVOKE OWNERSHIP ON FUTURE TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  - name: "OWNERSHIP on FUTURE EXTERNAL_TABLES"
    grant:
      privilege: OWNERSHIP
      objectType: EXTERNAL_TABLE
      objectName: MOCK_DB.MOCK_SCHEMA.<EXTERNAL_TABLE>
      role: MOCK_ROLE_1
      future: true
    expectedGrantStatement: "GRANT OWNERSHIP ON FUTURE EXTERNAL TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "REVOKE OWNERSHIP ON FUTURE EXTERNAL TABLES IN SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  # Account-Level Privileges
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#global-privileges
  - name: "CREATE DATABASE on ACCOUNT"
    grant:
      privilege: CREATE DATABASE
      objectType: ACCOUNT
      objectName: ""
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT CREATE DATABASE ON ACCOUNT TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE CREATE DATABASE ON ACCOUNT FROM ROLE MOCK_ROLE_1;"

  # Role Grants
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#account-object-privileges
  - name: "USAGE on ROLE"
    grant:
      privilege: USAGE
      objectType: ROLE
      objectName: MOCK_ROLE_2
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT ROLE \"MOCK_ROLE_2\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE ROLE \"MOCK_ROLE_2\" FROM ROLE MOCK_ROLE_1;"

  # Semantic Views
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#schema-object-privileges
  - name: "OWNERSHIP on SEMANTIC_VIEW"
    grant:
      privilege: OWNERSHIP
      objectType: SEMANTIC_VIEW
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_VIEW
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT OWNERSHIP ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "GRANT OWNERSHIP ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" TO ROLE SECURITYADMIN COPY CURRENT GRANTS;"

  - name: "SELECT on SEMANTIC_VIEW"
    grant:
      privilege: SELECT
      objectType: SEMANTIC_VIEW
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_VIEW
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT SELECT ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE SELECT ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" FROM ROLE MOCK_ROLE_1;"

  - name: "REFERENCES on SEMANTIC_VIEW"
    grant:
      privilege: REFERENCES
      objectType: SEMANTIC_VIEW
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_VIEW
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT REFERENCES ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE REFERENCES ON SEMANTIC VIEW \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_VIEW\" FROM ROLE MOCK_ROLE_1;"

  # Schema-Level Privileges
  # https://docs.snowflake.com/en/sql-reference/sql/grant-privilege#schema-privileges
  - name: "CREATE SEMANTIC VIEW on SCHEMA"
    grant:
      privilege: CREATE SEMANTIC VIEW
      objectType: SCHEMA
      objectName: MOCK_DB.MOCK_SCHEMA
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT CREATE SEMANTIC VIEW ON SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE CREATE SEMANTIC VIEW ON SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

  # Agents (Cortex)
  # https://docs.snowflake.com/en/user-guide/snowflake-cortex/cortex-agents
  - name: "OWNERSHIP on AGENT"
    grant:
      privilege: OWNERSHIP
      objectType: AGENT
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_AGENT
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT OWNERSHIP ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" TO ROLE MOCK_ROLE_1 COPY CURRENT GRANTS;"
    expectedRevokeStatement: "GRANT OWNERSHIP ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" TO ROLE SECURITYADMIN COPY CURRENT GRANTS;"

  - name: "USAGE on AGENT"
    grant:
      privilege: USAGE
      objectType: AGENT
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_AGENT
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT USAGE ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE USAGE ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" FROM ROLE MOCK_ROLE_1;"

  - name: "MODIFY on AGENT"
    grant:
      privilege: MODIFY
      objectType: AGENT
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_AGENT
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT MODIFY ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE MODIFY ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" FROM ROLE MOCK_ROLE_1;"

  - name: "MONITOR on AGENT"
    grant:
      privilege: MONITOR
      objectType: AGENT
      objectName: MOCK_DB.MOCK_SCHEMA.MOCK_AGENT
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT MONITOR ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE MONITOR ON AGENT \"MOCK_DB\".\"MOCK_SCHEMA\".\"MOCK_AGENT\" FROM ROLE MOCK_ROLE_1;"

  - name: "CREATE AGENT on SCHEMA"
    grant:
      privilege: CREATE AGENT
      objectType: SCHEMA
      objectName: MOCK_DB.MOCK_SCHEMA
      role: MOCK_ROLE_1
    expectedGrantStatement: "GRANT CREATE AGENT ON SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" TO ROLE MOCK_ROLE_1;"
    expectedRevokeStatement: "REVOKE CREATE AGENT ON SCHEMA \"MOCK_DB\".\"MOCK_SCHEMA\" FROM ROLE MOCK_ROLE_1;"

